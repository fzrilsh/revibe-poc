generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  nickname          String                 @map("nickname")
  birthYear         Int?                   @map("birth_year")
  profileImage      String?                @map("profile_image")
  skinType          SkinType?              @map("skin_type")
  createdAt         DateTime               @default(now()) @map("created_at")
  id                String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  comments          Comment[]
  likes             Like[]
  posts             Post[]
  items             Item[]
  onboardingAnswers UserOnboardingAnswer[]
  skinConcerns      UserSkinConcern[]

  @@map("users")
}

model SkinConcern {
  id                 Int               @id @default(autoincrement())
  name               String            @unique
  user_skin_concerns UserSkinConcern[]

  @@map("skin_concerns")
}

model UserSkinConcern {
  skinConcernId Int         @map("skin_concern_id")
  userId        String      @map("user_id") @db.Uuid
  skinConcern   SkinConcern @relation(fields: [skinConcernId], references: [id])
  user          User        @relation(fields: [userId], references: [id])

  @@id([userId, skinConcernId])
  @@map("user_skin_concerns")
}

model OnboardingQuestion {
  id                    Int                    @id @default(autoincrement())
  text                  String
  order                 Int                    @default(0)
  createdAt             DateTime               @default(now()) @map("created_at")
  userOnboardingAnswers UserOnboardingAnswer[]

  @@map("onboarding_questions")
}

model UserOnboardingAnswer {
  id         Int                @id @default(autoincrement())
  value      String
  createdAt  DateTime           @default(now()) @map("created_at")
  questionId Int                @map("question_id")
  userId     String             @map("user_id") @db.Uuid
  question   OnboardingQuestion @relation(fields: [questionId], references: [id])
  user       User               @relation(fields: [userId], references: [id])

  @@map("user_onboarding_answers")
}

model Post {
  id        Int      @id @default(autoincrement())
  userId    String   @map("user_id") @db.Uuid
  content   String?  @map("content")
  imageUrl  String?  @map("image_url")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id])

  @@map("posts")
}

model Comment {
  id         Int      @id @default(autoincrement())
  userId     String   @map("user_id") @db.Uuid
  targetType String   @map("target_type")
  targetId   Int      @map("target_id")
  content    String   @map("content")
  createdAt  DateTime @default(now()) @map("created_at")
  user       User     @relation(fields: [userId], references: [id])

  @@index([targetType, targetId])
  @@map("comments")
}

model Like {
  id         Int      @id @default(autoincrement())
  userId     String   @map("user_id") @db.Uuid
  targetType String   @map("target_type")
  targetId   Int      @map("target_id")
  createdAt  DateTime @default(now()) @map("created_at")
  user       User     @relation(fields: [userId], references: [id])

  @@unique([userId, targetType, targetId])
  @@map("likes")
}

enum SkinType {
  OILY
  DRY
  COMBINATION
  SENSITIVE
  NORMAL
}

model Item {
  id               Int       @id @default(autoincrement())
  userId           String    @map("user_id") @db.Uuid
  brand            String?
  name             String?
  category         String?
  imageUrl         String?   @map("image_url")
  price            Int?      @map("price")
  expirationDate   DateTime? @map("expiration_date")
  openingDate      DateTime? @map("opening_date")
  paoMonths        Int?      @map("pao_months")
  status           String?
  isCurrentlyInUse Boolean?  @map("is_currently_in_use")
  usagePercentage  Int?      @map("usage_percentage")
  colorVariation   String?   @map("color_variation")
  createdAt        DateTime  @default(now()) @map("created_at")
  reminderEnabled  Boolean?  @map("reminder_enabled")
  reminderDate     DateTime? @map("reminder_date")

  user User @relation(fields: [userId], references: [id])

  reviews Review[]

  @@map("items")
}

model Review {
  id          Int      @id @default(autoincrement())
  itemId      Int      @map("item_id")
  rating      Int
  repurchase  Boolean? @map("repurchase")
  usagePeriod String?  @map("usage_period")
  content     String?  @map("content")
  createdAt   DateTime @default(now()) @map("created_at")

  item Item @relation(fields: [itemId], references: [id])

  @@map("reviews")
}
